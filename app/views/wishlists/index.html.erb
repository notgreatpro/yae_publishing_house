<!-- app/views/wishlists/index.html.erb -->

<div class="yae-wishlist-page">
  <div class="container my-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb yae-breadcrumb">
        <li class="breadcrumb-item">
          <%= link_to root_path do %>
            <i class="bi bi-house-fill me-1"></i>Home
          <% end %>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
          <i class="bi bi-heart-fill me-1"></i>My Wishlist
        </li>
      </ol>
    </nav>

    <!-- Page Header -->
    <div class="yae-page-header text-center mb-5">
      <h1 class="yae-page-title">
        <i class="bi bi-heart-fill me-3"></i>My Wishlist
      </h1>
      <div class="yae-title-underline"></div>
      <p class="yae-page-subtitle mt-3">
        <%= pluralize(@wishlist_items.count, 'item') %> saved for later
      </p>
    </div>

    <% if @wishlist_items.any? %>
      <div class="row g-4">
        <% @wishlist_items.each do |wishlist_item| %>
          <% product = wishlist_item.product %>
          <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="yae-wishlist-card">
              <!-- Remove Button -->
              <%= button_to wishlist_path(wishlist_item), 
                  method: :delete, 
                  class: 'yae-remove-btn',
                  form: { data: { turbo_confirm: 'Remove from wishlist?' } } do %>
                <i class="bi bi-x-circle-fill"></i>
              <% end %>

              <!-- Product Image -->
              <%= link_to product_path(product), class: 'yae-wishlist-image-link' do %>
                <div class="yae-wishlist-image">
                  <% if product.cover_image.attached? %>
                    <%= image_tag product.medium_image, alt: product.title, class: 'yae-product-img' %>
                  <% else %>
                    <div class="yae-product-placeholder">
                      <i class="bi bi-book"></i>
                    </div>
                  <% end %>
                </div>
              <% end %>

              <!-- Product Info -->
              <div class="yae-wishlist-info">
                <%= link_to product_path(product), class: 'yae-wishlist-title-link' do %>
                  <h6 class="yae-wishlist-title">
                    <%= truncate(product.title, length: 60) %>
                  </h6>
                <% end %>

                <% if product.authors.any? %>
                  <p class="yae-wishlist-author">
                    <i class="bi bi-person-fill me-1"></i>
                    <%= product.authors.first.author_name %>
                  </p>
                <% end %>

                <!-- Rating -->
                <% if product.average_rating > 0 %>
                  <div class="yae-wishlist-rating">
                    <%= render 'shared/star_rating', rating: product.average_rating %>
                    <span class="yae-rating-count">
                      (<%= product.ratings_count %>)
                    </span>
                  </div>
                <% end %>

                <!-- Price -->
                <div class="yae-wishlist-price">
                  <%= number_to_currency(product.current_price) %>
                </div>

                <!-- Actions -->
                <div class="yae-wishlist-actions">
                  <%= link_to product_path(product), class: 'yae-btn yae-btn-view' do %>
                    <i class="bi bi-eye-fill me-2"></i>View Details
                  <% end %>
                  
                  <%= button_to add_to_cart_path(product_id: product.id), 
                      method: :post,
                      class: 'yae-btn yae-btn-cart',
                      form: { data: { turbo: false } } do %>
                    <i class="bi bi-cart-plus-fill me-2"></i>Add to Cart
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Continue Shopping -->
      <div class="text-center mt-5">
        <%= link_to products_path, class: 'yae-btn yae-btn-primary yae-btn-large' do %>
          <i class="bi bi-book me-2"></i>Continue Shopping
        <% end %>
      </div>

    <% else %>
      <!-- Empty Wishlist -->
      <div class="yae-empty-wishlist">
        <div class="yae-empty-icon">
          <i class="bi bi-heart"></i>
        </div>
        <h3 class="yae-empty-title">Your Wishlist is Empty</h3>
        <p class="yae-empty-text">
          Save your favorite books here and come back to them anytime!
        </p>
        <%= link_to products_path, class: 'yae-btn yae-btn-primary yae-btn-large' do %>
          <i class="bi bi-book me-2"></i>Browse Products
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<style>
  :root {
    --yae-pink: #E91E8C;
    --yae-purple: #8B2C7F;
    --yae-dark: #4A1942;
    --yae-light-pink: #F8C8DC;
  }

  .yae-wishlist-page {
    background: linear-gradient(135deg, #fce7f3 0%, #e9d5ff 100%);
    min-height: 100vh;
    padding: 2rem 0;
  }

  /* Breadcrumb */
  .yae-breadcrumb {
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    margin-bottom: 2rem;
  }

  .yae-breadcrumb a {
    color: var(--yae-purple);
    text-decoration: none;
    font-weight: 600;
    transition: color 0.3s ease;
  }

  .yae-breadcrumb a:hover {
    color: var(--yae-pink);
  }

  /* Page Header */
  .yae-page-header {
    margin-bottom: 3rem;
  }

  .yae-page-title {
    font-size: 3rem;
    font-weight: 700;
    color: var(--yae-purple);
    margin-bottom: 1rem;
  }

  .yae-title-underline {
    width: 100px;
    height: 4px;
    background: linear-gradient(90deg, var(--yae-pink), var(--yae-purple));
    margin: 0 auto;
    border-radius: 2px;
  }

  .yae-page-subtitle {
    color: #6b7280;
    font-size: 1.2rem;
    font-weight: 500;
  }

  /* Wishlist Card */
  .yae-wishlist-card {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    position: relative;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .yae-wishlist-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 30px rgba(139, 44, 127, 0.3);
  }

  /* Remove Button */
  .yae-remove-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 10;
    background: white;
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  .yae-remove-btn i {
    font-size: 1.3rem;
    color: #dc2626;
  }

  .yae-remove-btn:hover {
    transform: scale(1.1);
    background: #dc2626;
  }

  .yae-remove-btn:hover i {
    color: white;
  }

  /* Product Image */
  .yae-wishlist-image-link {
    display: block;
  }

  .yae-wishlist-image {
    width: 100%;
    aspect-ratio: 2/3;
    overflow: hidden;
    background: #f8f9fa;
    position: relative;
  }

  .yae-product-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .yae-wishlist-card:hover .yae-product-img {
    transform: scale(1.05);
  }

  .yae-product-placeholder {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--yae-purple) 0%, var(--yae-dark) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 3rem;
  }

  /* Product Info */
  .yae-wishlist-info {
    padding: 1.25rem;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }

  .yae-wishlist-title-link {
    text-decoration: none;
  }

  .yae-wishlist-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--yae-dark);
    margin-bottom: 0.5rem;
    min-height: 3rem;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    transition: color 0.3s ease;
  }

  .yae-wishlist-title-link:hover .yae-wishlist-title {
    color: var(--yae-pink);
  }

  .yae-wishlist-author {
    font-size: 0.9rem;
    color: #6b7280;
    margin-bottom: 0.75rem;
    font-style: italic;
  }

  .yae-wishlist-rating {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    font-size: 0.9rem;
  }

  .yae-wishlist-rating i {
    color: #ffc107;
  }

  .yae-rating-count {
    color: #9ca3af;
    font-size: 0.85rem;
  }

  .yae-wishlist-price {
    font-size: 1.5rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--yae-pink) 0%, var(--yae-purple) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1rem;
  }

  /* Actions */
  .yae-wishlist-actions {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-top: auto;
  }

  .yae-btn {
    padding: 0.75rem 1.25rem;
    border-radius: 12px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
    text-align: center;
  }

  .yae-btn-view {
    background: white;
    color: var(--yae-purple);
    border: 2px solid var(--yae-purple);
  }

  .yae-btn-view:hover {
    background: var(--yae-purple);
    color: white;
  }

  .yae-btn-cart {
    background: linear-gradient(135deg, var(--yae-purple) 0%, var(--yae-dark) 100%);
    color: white;
  }

  .yae-btn-cart:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(139, 44, 127, 0.4);
  }

  .yae-btn-primary {
    background: linear-gradient(135deg, var(--yae-purple) 0%, var(--yae-dark) 100%);
    color: white;
    padding: 1rem 2.5rem;
    border-radius: 25px;
    font-size: 1.1rem;
  }

  .yae-btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(139, 44, 127, 0.4);
    color: white;
  }

  .yae-btn-large {
    padding: 1.25rem 3rem;
    font-size: 1.2rem;
  }

  /* Empty Wishlist */
  .yae-empty-wishlist {
    background: white;
    border-radius: 25px;
    padding: 5rem 3rem;
    text-align: center;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
    border: 3px solid var(--yae-purple);
  }

  .yae-empty-icon {
    font-size: 8rem;
    color: #e5e7eb;
    margin-bottom: 2rem;
  }

  .yae-empty-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--yae-dark);
    margin-bottom: 1rem;
  }

  .yae-empty-text {
    font-size: 1.2rem;
    color: #6b7280;
    margin-bottom: 2.5rem;
  }

  /* Responsive */
  @media (max-width: 767px) {
    .yae-page-title {
      font-size: 2rem;
    }

    .yae-page-subtitle {
      font-size: 1rem;
    }

    .yae-empty-wishlist {
      padding: 3rem 2rem;
    }

    .yae-empty-icon {
      font-size: 5rem;
    }

    .yae-empty-title {
      font-size: 1.5rem;
    }

    .yae-empty-text {
      font-size: 1rem;
    }

    .yae-btn-large {
      padding: 1rem 2rem;
      font-size: 1rem;
    }
  }
</style>

<!-- Ensure Bootstrap Icons are loaded -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">