<!-- app/views/orders/show.html.erb -->

<div class="container my-4">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><%= link_to 'Home', root_path %></li>
      <li class="breadcrumb-item"><%= link_to 'My Orders', orders_path %></li>
      <li class="breadcrumb-item active" aria-current="page">Order #<%= @order.id %></li>
    </ol>
  </nav>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2 mb-0">Order #<%= @order.id %></h1>
    <% if @order.paid? %>
      <span class="badge bg-success fs-6">PAID</span>
    <% elsif @order.shipped? %>
      <span class="badge bg-info fs-6">SHIPPED</span>
    <% elsif @order.cancelled? %>
      <span class="badge" style="background-color: #f8d7da; color: #721c24;" fs-6>CANCELLED</span>
    <% else %>
      <span class="badge bg-warning text-dark fs-6">PENDING</span>
    <% end %>
  </div>

  <div class="row">
    <!-- Main Content -->
    <div class="col-lg-8">
      <!-- Shipping Address -->
      <div class="card mb-4 shadow-sm">
        <div class="card-body">
          <h3 class="h5 card-title mb-3">Shipping Address</h3>
          <p class="mb-1"><strong><%= @order.customer.first_name %> <%= @order.customer.last_name %></strong></p>
          <p class="mb-1"><%= @order.address_line1 %></p>
          <% if @order.address_line2.present? %>
            <p class="mb-1"><%= @order.address_line2 %></p>
          <% end %>
          <p class="mb-0"><%= @order.city %>, <%= @order.province.name %> <%= @order.postal_code %></p>
        </div>
      </div>

      <!-- Order Items -->
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="h5 card-title mb-4">Order Items</h3>
          
          <% @order.order_items.each do |item| %>
            <div class="row align-items-center mb-3 pb-3 border-bottom">
              <div class="col-auto">
                <% if item.product.cover_image.attached? %>
                  <%= image_tag item.product.cover_image, alt: item.product.title, 
                      class: 'rounded', style: 'width: 80px; height: 100px; object-fit: cover;' %>
                <% else %>
                  <div class="text-white rounded d-flex align-items-center justify-content-center" 
                       style="width: 80px; height: 100px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    ðŸ“š
                  </div>
                <% end %>
              </div>
              <div class="col">
                <h4 class="h6 mb-2"><%= item.product.title %></h4>
                <p class="text-muted small mb-0">Quantity: <%= item.quantity %></p>
              </div>
              <div class="col-auto text-end">
                <strong class="fs-5"><%= number_to_currency(item.price_at_purchase * item.quantity) %></strong>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Order Summary Sidebar -->
    <div class="col-lg-4 mt-4 mt-lg-0">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-white">
          <h3 class="h5 mb-0">Order Summary</h3>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal:</span>
            <strong><%= number_to_currency(@order.subtotal) %></strong>
          </div>
          
          <% if @order.gst_amount && @order.gst_amount > 0 %>
            <div class="d-flex justify-content-between mb-2 text-muted small">
              <span>GST (<%= number_to_percentage(@order.gst_rate, precision: 1) %>):</span>
              <span><%= number_to_currency(@order.gst_amount) %></span>
            </div>
          <% end %>
          
          <% if @order.pst_amount && @order.pst_amount > 0 %>
            <div class="d-flex justify-content-between mb-2 text-muted small">
              <span>PST (<%= number_to_percentage(@order.pst_rate, precision: 1) %>):</span>
              <span><%= number_to_currency(@order.pst_amount) %></span>
            </div>
          <% end %>
          
          <% if @order.hst_amount && @order.hst_amount > 0 %>
            <div class="d-flex justify-content-between mb-2 text-muted small">
              <span>HST (<%= number_to_percentage(@order.hst_rate, precision: 1) %>):</span>
              <span><%= number_to_currency(@order.hst_amount) %></span>
            </div>
          <% end %>

          <hr>

          <div class="d-flex justify-content-between fs-4 fw-bold">
            <span>Total:</span>
            <span style="color: #27ae60;"><%= number_to_currency(@order.total_amount) %></span>
          </div>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-body">
          <p class="mb-2"><strong>Order Date:</strong></p>
          <p class="text-muted mb-4"><%= @order.created_at.strftime('%B %d, %Y at %I:%M %p') %></p>
          
          <div class="d-grid">
            <%= link_to 'Back to Orders', orders_path, class: 'btn btn-primary' %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>