<!-- app/views/products/show.html.erb -->

<div class="yae-product-show">
  <div class="container mt-4 mb-5">
    
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb yae-breadcrumb">
        <li class="breadcrumb-item"><%= link_to 'Home', root_path %></li>
        <li class="breadcrumb-item"><%= link_to 'Products', products_path %></li>
        <li class="breadcrumb-item active" aria-current="page"><%= truncate(@product.title, length: 50) %></li>
      </ol>
    </nav>

    <div class="row mt-4 g-4">
      <!-- Product Image Column -->
      <div class="col-lg-5 col-md-6">
        <div class="yae-product-image-container">
          <% if @product.cover_image.attached? %>
            <%= image_tag @product.large_image, alt: @product.title, class: 'yae-product-image-large' %>
          <% else %>
            <div class="yae-placeholder-large">
              <i class="bi bi-book"></i>
              <p>No cover image available</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Product Information Column -->
      <div class="col-lg-7 col-md-6">
        <div class="yae-product-header">
          <h1 class="yae-product-main-title"><%= @product.title %></h1>
          
          <% if @product.authors.any? %>
            <p class="yae-product-authors">
              by <%= @product.authors.map(&:author_name).join(', ') %>
            </p>
          <% end %>

          <!-- Rating Display -->
          <div class="yae-rating-section">
            <div class="d-flex align-items-center gap-3">
              <div class="yae-rating-stars-large">
                <%= render 'shared/star_rating', rating: @product.average_rating %>
              </div>
              <span class="yae-rating-text">
                <%= number_with_precision(@product.average_rating, precision: 1) %>
                (<%= @product.ratings_count %> <%= 'review'.pluralize(@product.ratings_count) %>)
              </span>
            </div>
          </div>

          <!-- Badges -->
          <div class="yae-badges-section">
            <% if @product.category %>
              <span class="yae-category-badge">
                <i class="bi bi-tag-fill me-1"></i><%= @product.category.category_name %>
              </span>
            <% end %>
            
            <% if @product.created_at >= 3.days.ago %>
              <span class="yae-new-badge">
                <i class="bi bi-star-fill me-1"></i>NEW
              </span>
            <% end %>
          </div>
        </div>

        <!-- Price Section -->
        <div class="yae-price-card">
          <div class="yae-price-amount">
            <%= number_to_currency(@product.current_price) %>
          </div>
          
          <% if @product.stock_quantity && @product.stock_quantity > 0 %>
            <div class="yae-stock-status in-stock">
              <i class="bi bi-check-circle-fill me-2"></i>
              In Stock (<%= @product.stock_quantity %> available)
            </div>
          <% else %>
            <div class="yae-stock-status out-of-stock">
              <i class="bi bi-x-circle-fill me-2"></i>
              Out of Stock
            </div>
          <% end %>
        </div>

        <!-- Add to Cart Form -->
        <div class="yae-cart-section">
          <%= form_with url: cart_add_path, method: :post, local: true, class: 'yae-cart-form' do |f| %>
            <%= f.hidden_field :product_id, value: @product.id %>
            <%= render_wishlist_button(@product, show_text: true) %>
            
            <div class="yae-quantity-section">
              <label for="quantity" class="yae-quantity-label">
                <i class="bi bi-hash me-1"></i>Quantity:
              </label>
              <%= f.number_field :quantity, value: 1, min: 1, max: @product.stock_quantity || 99, 
                  class: 'yae-quantity-input' %>
            </div>
            
            <% if @product.stock_quantity && @product.stock_quantity > 0 %>
              <%= f.submit 'Add to Cart', class: 'btn yae-add-to-cart-btn' %>
            <% else %>
              <button class="btn yae-out-of-stock-btn" disabled>
                <i class="bi bi-x-circle me-2"></i>Out of Stock
              </button>
            <% end %>
          <% end %>
        </div>

        <!-- Product Description -->
        <div class="yae-description-section">
          <h3 class="yae-section-title">
            <i class="bi bi-file-text-fill me-2"></i>About This Book
          </h3>
          <div class="yae-description-text">
            <%= simple_format(@product.description) %>
          </div>
        </div>

        <!-- Product Details -->
        <div class="yae-details-card">
          <h3 class="yae-section-title mb-3">
            <i class="bi bi-info-circle-fill me-2"></i>Product Details
          </h3>
          
          <% if @product.isbn.present? %>
            <div class="yae-detail-row">
              <span class="yae-detail-label">ISBN:</span>
              <span class="yae-detail-value"><%= @product.isbn %></span>
            </div>
          <% end %>

          <% if @product.publisher.present? %>
            <div class="yae-detail-row">
              <span class="yae-detail-label">Publisher:</span>
              <span class="yae-detail-value"><%= @product.publisher %></span>
            </div>
          <% end %>

          <% if @product.publication_date.present? %>
            <div class="yae-detail-row">
              <span class="yae-detail-label">Publication Date:</span>
              <span class="yae-detail-value"><%= @product.publication_date.strftime('%B %d, %Y') %></span>
            </div>
          <% end %>

          <% if @product.pages.present? %>
            <div class="yae-detail-row">
              <span class="yae-detail-label">Pages:</span>
              <span class="yae-detail-value"><%= @product.pages %></span>
            </div>
          <% end %>

          <% if @product.language.present? %>
            <div class="yae-detail-row">
              <span class="yae-detail-label">Language:</span>
              <span class="yae-detail-value"><%= @product.language %></span>
            </div>
          <% end %>
        </div>

        <!-- Back Link -->
        <%= link_to products_path, class: 'btn yae-back-btn' do %>
          <i class="bi bi-arrow-left me-2"></i>Back to Products
        <% end %>
      </div>
    </div>

    <!-- Reviews Section -->
    <div class="row mt-5">
      <div class="col-12">
        <div class="yae-reviews-section">
          <h3 class="yae-section-title mb-4">
            <i class="bi bi-chat-left-text-fill me-2"></i>Customer Reviews
          </h3>

          <!-- Customer's Rating Form -->
          <% if customer_signed_in? %>
            <div class="yae-review-form-card">
              <h5 class="yae-review-form-title">
                <i class="bi bi-pencil-square me-2"></i>Write a Review
              </h5>
              <%= form_with model: Rating.new, url: product_ratings_path(@product), 
                  local: true, class: 'yae-rating-form' do |f| %>
                
                <div class="mb-4">
                  <label class="yae-form-label">Your Rating</label>
                  <div class="yae-star-input">
                    <% (1..5).reverse_each do |i| %>
                      <%= f.radio_button :score, i, id: "rating_new_#{i}", class: 'd-none' %>
                      <label for="rating_new_<%= i %>" class="yae-star-label">
                        <i class="bi bi-star-fill"></i>
                      </label>
                    <% end %>
                  </div>
                </div>

                <div class="mb-4">
                  <%= f.label :review, 'Your Review (Optional)', class: 'yae-form-label' %>
                  <%= f.text_area :review, class: 'yae-form-textarea', rows: 4, 
                      placeholder: 'Share your thoughts about this book...' %>
                </div>

                <%= f.submit 'Submit Review', class: 'btn yae-submit-review-btn' %>
              <% end %>
            </div>
          <% else %>
            <div class="yae-sign-in-prompt">
              <i class="bi bi-person-circle me-2"></i>
              <%= link_to 'Sign in', new_customer_session_path %> to leave a review.
            </div>
          <% end %>

          <!-- Display All Reviews -->
          <div class="yae-reviews-list mt-4">
            <% @product.ratings.order(created_at: :desc).each do |rating| %>
              <div class="yae-review-card">
                <div class="d-flex gap-3">
                  <!-- Customer Avatar -->
                  <div class="flex-shrink-0">
                    <% if rating.customer.profile_picture.attached? %>
                      <%= image_tag rating.customer.profile_picture.variant(resize_to_fill: [60, 60]), 
                          class: 'yae-review-avatar',
                          alt: rating.customer.full_name %>
                    <% else %>
                      <div class="yae-review-avatar-placeholder">
                        <%= rating.customer.initials %>
                      </div>
                    <% end %>
                  </div>

                  <!-- Review Content -->
                  <div class="flex-grow-1">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                      <div>
                        <h6 class="yae-reviewer-name"><%= rating.customer.full_name %></h6>
                        <div class="yae-review-stars mb-1">
                          <%= render 'shared/star_rating', rating: rating.score %>
                        </div>
                      </div>
                      <div class="d-flex align-items-center gap-2">
                        <small class="yae-review-date">
                          <%= rating.created_at.strftime('%B %d, %Y') %>
                        </small>
                        
                        <% if customer_signed_in? && rating.customer == current_customer %>
                          <div class="dropdown">
                            <button class="yae-review-menu-btn" type="button" 
                                    id="reviewMenu<%= rating.id %>" data-bs-toggle="dropdown">
                              <i class="bi bi-three-dots-vertical"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                              <li>
                                <a class="dropdown-item" href="#" onclick="showEditForm(<%= rating.id %>); return false;">
                                  <i class="bi bi-pencil me-2"></i>Edit Review
                                </a>
                              </li>
                              <li><hr class="dropdown-divider"></li>
                              <li>
                                <%= button_to product_rating_path(@product, rating), 
                                    method: :delete, 
                                    class: 'dropdown-item text-danger',
                                    data: { confirm: 'Delete this review?' },
                                    form: { style: 'display: inline;' } do %>
                                  <i class="bi bi-trash me-2"></i>Delete Review
                                <% end %>
                              </li>
                            </ul>
                          </div>
                        <% end %>
                      </div>
                    </div>
                    
                    <!-- Review Text -->
                    <div id="review-view-<%= rating.id %>">
                      <% if rating.review.present? %>
                        <p class="yae-review-text"><%= rating.review %></p>
                      <% end %>
                    </div>

                    <!-- Edit Form (Hidden) -->
                    <% if customer_signed_in? && rating.customer == current_customer %>
                      <div id="review-edit-<%= rating.id %>" style="display: none;">
                        <%= form_with model: rating, url: product_rating_path(@product, rating), 
                            method: :patch, local: true do |f| %>
                          
                          <div class="mb-3">
                            <label class="yae-form-label">Rating</label>
                            <div class="yae-star-input">
                              <% (1..5).reverse_each do |i| %>
                                <%= f.radio_button :score, i, id: "rating_edit_#{rating.id}_#{i}", class: 'd-none', checked: rating.score == i %>
                                <label for="rating_edit_<%= rating.id %>_<%= i %>" class="yae-star-label">
                                  <i class="bi bi-star-fill"></i>
                                </label>
                              <% end %>
                            </div>
                          </div>

                          <div class="mb-3">
                            <%= f.label :review, 'Your Review', class: 'yae-form-label' %>
                            <%= f.text_area :review, class: 'yae-form-textarea', rows: 3 %>
                          </div>

                          <div class="d-flex gap-2">
                            <%= f.submit 'Update Review', class: 'btn yae-update-btn' %>
                            <button type="button" class="btn yae-cancel-btn" onclick="hideEditForm(<%= rating.id %>)">
                              Cancel
                            </button>
                          </div>
                        <% end %>
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>

            <% if @product.ratings.empty? %>
              <div class="yae-no-reviews">
                <i class="bi bi-chat-left-dots display-4 text-muted mb-3"></i>
                <p>No reviews yet. Be the first to review this book!</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- You May Also Like Section -->
    <div class="row mt-5">
      <div class="col-12">
        <h3 class="yae-section-title mb-4">
          <i class="bi bi-heart-fill me-2"></i>You May Also Like
        </h3>
        
        <div class="row g-4">
          <% @related_products.each do |product| %>
            <div class="col-lg-2 col-md-3 col-sm-4 col-6">
              <%= link_to product_path(product), class: 'text-decoration-none' do %>
                <div class="yae-recommendation-card">
                  <div class="yae-recommendation-image">
                    <% if product.cover_image.attached? %>
                      <%= image_tag product.medium_image, alt: product.title %>
                    <% else %>
                      <div class="yae-recommendation-placeholder">
                        <i class="bi bi-book"></i>
                      </div>
                    <% end %>
                  </div>
                  
                  <div class="yae-recommendation-info">
                    <h6 class="yae-recommendation-title">
                      <%= truncate(product.title, length: 40) %>
                    </h6>
                    
                    <% if product.authors.any? %>
                      <p class="yae-recommendation-author">
                        <%= product.authors.first.author_name %>
                      </p>
                    <% end %>

                    <% if product.average_rating > 0 %>
                      <div class="yae-recommendation-rating">
                        <div class="yae-stars-small">
                          <%= render 'shared/star_rating', rating: product.average_rating %>
                        </div>
                        <span>(<%= product.ratings_count %>)</span>
                      </div>
                    <% end %>
                    
                    <div class="yae-recommendation-price">
                      <%= number_to_currency(product.current_price) %>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Recently Viewed Section -->
    <% if @recently_viewed_products.present? %>
      <div class="row mt-5 mb-5">
        <div class="col-12">
          <h3 class="yae-section-title mb-4">
            <i class="bi bi-clock-history me-2"></i>Recently Viewed
          </h3>
          
          <div class="row g-4">
            <% @recently_viewed_products.each do |product| %>
              <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                <%= link_to product_path(product), class: 'text-decoration-none' do %>
                  <div class="yae-recommendation-card">
                    <div class="yae-recommendation-image">
                      <% if product.cover_image.attached? %>
                        <%= image_tag product.medium_image, alt: product.title %>
                      <% else %>
                        <div class="yae-recommendation-placeholder">
                          <i class="bi bi-book"></i>
                        </div>
                      <% end %>
                    </div>
                    
                    <div class="yae-recommendation-info">
                      <h6 class="yae-recommendation-title">
                        <%= truncate(product.title, length: 40) %>
                      </h6>
                      
                      <% if product.authors.any? %>
                        <p class="yae-recommendation-author">
                          <%= product.authors.first.author_name %>
                        </p>
                      <% end %>

                      <% if product.average_rating > 0 %>
                        <div class="yae-recommendation-rating">
                          <div class="yae-stars-small">
                            <%= render 'shared/star_rating', rating: product.average_rating %>
                          </div>
                          <span>(<%= product.ratings_count %>)</span>
                        </div>
                      <% end %>
                      
                      <div class="yae-recommendation-price">
                        <%= number_to_currency(product.current_price) %>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<style>
  :root {
    --yae-pink: #E91E8C;
    --yae-purple: #8B2C7F;
    --yae-dark: #4A1942;
    --yae-light-pink: #F8C8DC;
  }

  .yae-product-show {
    background: linear-gradient(135deg, #fce7f3 0%, #e9d5ff 100%);
    min-height: 100vh;
    padding: 2rem 0;
  }

  /* Breadcrumb */
  .yae-breadcrumb {
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }

  .yae-breadcrumb a {
    color: var(--yae-purple);
    text-decoration: none;
    font-weight: 600;
  }

  .yae-breadcrumb a:hover {
    color: var(--yae-pink);
  }

  /* Product Image */
  .yae-product-image-container {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
    position: sticky;
    top: 2rem;
  }

  .yae-product-image-large {
    width: 100%;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  }

  .yae-placeholder-large {
    aspect-ratio: 2/3;
    background: linear-gradient(135deg, var(--yae-purple) 0%, var(--yae-dark) 100%);
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 6rem;
  }

  .yae-placeholder-large p {
    font-size: 1.2rem;
    margin-top: 1rem;
  }

  /* Product Header */
  .yae-product-header {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    margin-bottom: 1.5rem;
  }

  .yae-product-main-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--yae-dark);
    margin-bottom: 0.5rem;
  }

  .yae-product-authors {
    font-size: 1.3rem;
    color: #6b7280;
    font-style: italic;
    margin-bottom: 1rem;
  }

  /* Rating Section */
  .yae-rating-section {
    margin-bottom: 1.5rem;
  }

  .yae-rating-stars-large {
    font-size: 1.8rem;
  }

  .yae-rating-stars-large i {
    color: #ffc107;
  }

  .yae-rating-text {
    font-size: 1.1rem;
    color: #6b7280;
    font-weight: 600;
  }

  /* Badges */
  .yae-badges-section {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .yae-category-badge, .yae-new-badge {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
  }

  .yae-category-badge {
    background: linear-gradient(135deg, var(--yae-light-pink) 0%, #e9d5ff 100%);
    color: var(--yae-purple);
  }

  .yae-new-badge {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
  }

  /* Price Card */
  .yae-price-card {
    background: linear-gradient(135deg, var(--yae-purple) 0%, var(--yae-dark) 100%);
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(139, 44, 127, 0.3);
    margin-bottom: 1.5rem;
  }

  .yae-price-amount {
    font-size: 3rem;
    font-weight: 700;
    color: white;
    margin-bottom: 1rem;
  }

  .yae-stock-status {
    font-size: 1.2rem;
    font-weight: 600;
    display: flex;
    align-items: center;
  }

  .yae-stock-status.in-stock {
    color: #10b981;
  }

  .yae-stock-status.out-of-stock {
    color: #ef4444;
  }

  /* Cart Section */
  .yae-cart-section {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    margin-bottom: 1.5rem;
  }

  .yae-quantity-section {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .yae-quantity-label {
    font-weight: 600;
    color: var(--yae-purple);
    font-size: 1.1rem;
    margin-bottom: 0;
  }

  .yae-quantity-input {
    width: 100px;
    padding: 0.75rem;
    border: 2px solid var(--yae-purple);
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    text-align: center;
  }

  .yae-add-to-cart-btn {
    width: 100%;
    padding: 1.25rem;
    background: linear-gradient(135deg, var(--yae-pink) 0%, #d91479 100%);
    color: white;
    border: none;
    border-radius: 15px;
    font-size: 1.3rem;
    font-weight: 700;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .yae-add-to-cart-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(233, 30, 140, 0.4);
    background: linear-gradient(135deg, #d91479 0%, var(--yae-pink) 100%);
  }

  .yae-out-of-stock-btn {
    width: 100%;
    padding: 1.25rem;
    background: #9ca3af;
    color: white;
    border: none;
    border-radius: 15px;
    font-size: 1.3rem;
    font-weight: 700;
  }

  /* Description Section */
  .yae-description-section {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    margin-bottom: 1.5rem;
  }

  .yae-section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--yae-purple);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
  }

  .yae-description-text {
    line-height: 1.8;
    color: #4b5563;
    font-size: 1.05rem;
  }

  /* Details Card */
  .yae-details-card {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    margin-bottom: 1.5rem;
  }

  .yae-detail-row {
    display: flex;
    padding: 1rem 0;
    border-bottom: 1px solid #e5e7eb;
  }

  .yae-detail-row:last-child {
    border-bottom: none;
  }

  .yae-detail-label {
    flex: 0 0 40%;
    font-weight: 600;
    color: var(--yae-purple);
  }

  .yae-detail-value {
    flex: 1;
    color: #4b5563;
  }

  /* Back Button */
  .yae-back-btn {
    background: white;
    color: var(--yae-purple);
    border: 2px solid var(--yae-purple);
    padding: 0.75rem 2rem;
    border-radius: 15px;
    font-weight: 600;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
  }

  .yae-back-btn:hover {
    background: var(--yae-purple);
    color: white;
    transform: translateX(-5px);
  }

  /* Reviews Section */
  .yae-reviews-section {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }

  /* Review Form */
  .yae-review-form-card {
    background: linear-gradient(135deg, #fce7f3 0%, #e9d5ff 100%);
    padding: 2rem;
    border-radius: 15px;
    margin-bottom: 2rem;
  }

  .yae-review-form-title {
    color: var(--yae-purple);
    font-weight: 700;
    margin-bottom: 1.5rem;
  }

  .yae-form-label {
    font-weight: 600;
    color: var(--yae-purple);
    margin-bottom: 0.5rem;
    display: block;
  }

  .yae-star-input {
    display: flex;
    flex-direction: row-reverse;
    justify-content: flex-end;
    gap: 0.5rem;
  }

  .yae-star-label {
    cursor: pointer;
    font-size: 2.5rem;
    color: #d1d5db;
    transition: color 0.2s;
  }

  .yae-star-input input:checked ~ label,
  .yae-star-input label:hover,
  .yae-star-input label:hover ~ label {
    color: #ffc107;
  }

  .yae-form-textarea {
    width: 100%;
    padding: 1rem;
    border: 2px solid #e5e7eb;
    border-radius: 10px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }

  .yae-form-textarea:focus {
    border-color: var(--yae-purple);
    outline: none;
    box-shadow: 0 0 0 3px rgba(139, 44, 127, 0.1);
  }

  .yae-submit-review-btn {
    background: linear-gradient(135deg, var(--yae-purple) 0%, var(--yae-dark) 100%);
    color: white;
    padding: 0.75rem 2rem;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .yae-submit-review-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(139, 44, 127, 0.3);
  }

  /* Sign In Prompt */
  .yae-sign-in-prompt {
    background: linear-gradient(135deg, #fce7f3 0%, #e9d5ff 100%);
    padding: 1.5rem;
    border-radius: 10px;
    text-align: center;
    font-size: 1.1rem;
    color: var(--yae-dark);
  }

  .yae-sign-in-prompt a {
    color: var(--yae-purple);
    font-weight: 600;
    text-decoration: none;
  }

  .yae-sign-in-prompt a:hover {
    color: var(--yae-pink);
  }

  /* Review Cards */
  .yae-review-card {
    background: #f9fafb;
    padding: 1.5rem;
    border-radius: 15px;
    margin-bottom: 1rem;
    border: 2px solid #e5e7eb;
    transition: all 0.3s ease;
  }

  .yae-review-card:hover {
    border-color: var(--yae-purple);
    box-shadow: 0 4px 15px rgba(139, 44, 127, 0.1);
  }

  .yae-review-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid var(--yae-purple);
  }

  .yae-review-avatar-placeholder {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--yae-purple) 0%, var(--yae-dark) 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.5rem;
    border: 3px solid var(--yae-pink);
  }

  .yae-reviewer-name {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--yae-dark);
    margin-bottom: 0.25rem;
  }

  .yae-review-stars {
    font-size: 1rem;
  }

  .yae-review-stars i {
    color: #ffc107;
  }

  .yae-review-date {
    color: #9ca3af;
  }

  .yae-review-menu-btn {
    background: none;
    border: none;
    color: #9ca3af;
    font-size: 1.2rem;
    padding: 0;
    cursor: pointer;
    transition: color 0.3s ease;
  }

  .yae-review-menu-btn:hover {
    color: var(--yae-purple);
  }

  .yae-review-text {
    color: #4b5563;
    line-height: 1.7;
    margin-top: 1rem;
  }

  .yae-update-btn, .yae-cancel-btn {
    padding: 0.5rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    border: none;
    transition: all 0.3s ease;
  }

  .yae-update-btn {
    background: var(--yae-purple);
    color: white;
  }

  .yae-update-btn:hover {
    background: var(--yae-dark);
  }

  .yae-cancel-btn {
    background: #e5e7eb;
    color: #6b7280;
  }

  .yae-cancel-btn:hover {
    background: #d1d5db;
  }

  /* No Reviews */
  .yae-no-reviews {
    text-align: center;
    padding: 3rem;
    color: #9ca3af;
  }

  /* Recommendations */
  .yae-recommendation-card {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    height: 100%;
  }

  .yae-recommendation-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 8px 25px rgba(139, 44, 127, 0.2);
  }

  .yae-recommendation-image {
    aspect-ratio: 2/3;
    overflow: hidden;
  }

  .yae-recommendation-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .yae-recommendation-card:hover .yae-recommendation-image img {
    transform: scale(1.05);
  }

  .yae-recommendation-placeholder {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--yae-purple) 0%, var(--yae-dark) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 3rem;
  }

  .yae-recommendation-info {
    padding: 1rem;
  }

  .yae-recommendation-title {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--yae-dark);
    margin-bottom: 0.5rem;
    min-height: 2.5rem;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .yae-recommendation-author {
    font-size: 0.8rem;
    color: #6b7280;
    font-style: italic;
    margin-bottom: 0.5rem;
  }

  .yae-recommendation-rating {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    font-size: 0.75rem;
    color: #9ca3af;
  }

  .yae-stars-small {
    font-size: 0.75rem;
  }

  .yae-stars-small i {
    color: #ffc107;
  }

  .yae-recommendation-price {
    font-size: 1.2rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--yae-pink) 0%, var(--yae-purple) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .yae-product-main-title {
      font-size: 1.8rem;
    }

    .yae-product-authors {
      font-size: 1.1rem;
    }

    .yae-price-amount {
      font-size: 2.2rem;
    }

    .yae-product-image-container {
      position: relative;
      top: 0;
    }
  }
</style>

<script>
  // Star rating display on page load
  document.addEventListener('DOMContentLoaded', function() {
    const ratingInputs = document.querySelectorAll('.yae-star-input input[type="radio"]');
    ratingInputs.forEach(input => {
      if (input.checked) {
        const labels = input.parentElement.querySelectorAll('label');
        let foundChecked = false;
        labels.forEach(label => {
          if (label.getAttribute('for') === input.id) {
            foundChecked = true;
          }
          if (foundChecked) {
            label.style.color = '#ffc107';
          }
        });
      }
    });
  });

  // Show/hide edit form
  function showEditForm(ratingId) {
    document.getElementById('review-view-' + ratingId).style.display = 'none';
    document.getElementById('review-edit-' + ratingId).style.display = 'block';
  }

  function hideEditForm(ratingId) {
    document.getElementById('review-view-' + ratingId).style.display = 'block';
    document.getElementById('review-edit-' + ratingId).style.display = 'none';
  }
</script>

<!-- Ensure Bootstrap Icons are loaded -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">